switch:
  - platform: gpio
    id: ${relays_name}_${relays_channel0}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel0}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel0_pin}
      mode:
        output: true
      inverted: true

  - platform: gpio
    id: ${relays_name}_${relays_channel1}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel1}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel1_pin}
      mode:
        output: true
      inverted: true

  - platform: gpio
    id: ${relays_name}_${relays_channel2}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel2}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel2_pin}
      mode:
        output: true
      inverted: true
      
  - platform: gpio
    id: ${relays_name}_${relays_channel3}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel3}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel3_pin}
      mode:
        output: true
      inverted: true

  - platform: gpio
    id: ${relays_name}_${relays_channel4}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel4}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel4_pin}
      mode:
        output: true
      inverted: true

  - platform: gpio
    id: ${relays_name}_${relays_channel5}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel5}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel5_pin}
      mode:
        output: true
      inverted: true

  - platform: gpio
    id: ${relays_name}_${relays_channel6}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel6}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel6_pin}
      mode:
        output: true
      inverted: true

  - platform: gpio
    id: ${relays_name}_${relays_channel7}_${relays_sufix}
    name: ${name}_${relays_name}_${relays_channel7}_${relays_sufix}
    pin:
      sx1509: ${relays_hub}
      number: ${relays_channel7_pin}
      mode:
        output: true
      inverted: true

select:
  - platform: template
    name: "fp1_mode"
    id: fp1_mode
    options:
     - "Confort"    #Pas de signal envoyé
     - "Eco"        #Alternance pleine
     - "Hors-gel"   #Alternance négative
     - "Arret"      #Alternance positive
     - "Confort -1" #Alternance pleine temporisé (4'57"off/3"on/..)
     - "Confort -2" #Alternance pleine temporisé (4'53"off/7"on/..)
    initial_option: "Confort"
    optimistic: true
    set_action:
      - logger.log:
          format: "Chosen option: %s"
          args: ["x.c_str()"]
      - lambda: |-
          id(fp1_mode).state = x.c_str(); 
    on_value:
      then:
        - if:
            condition:
              - lambda: |- 
                  return id(fp1_mode).state == "Confort" ;
            then:
              - switch.turn_off: "${relays_name}_${relays_channel0}_${relays_sufix}"
              - switch.turn_off: "${relays_name}_${relays_channel1}_${relays_sufix}"
        - if:
            condition:
              - lambda: |- 
                  return id(fp1_mode).state == "Eco" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel0}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel1}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp1_mode).state == "Hors-gel" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel0}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel1}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp1_mode).state == "Arrêt" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel0}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel1}_${relays_sufix}
        - while:
            condition:
              - lambda: |- 
                  return id(fp1_mode).state == "Confort -1" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel0}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel1}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 57
              - switch.turn_on: ${relays_name}_${relays_channel0}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel1}_${relays_sufix}
              - delay: 3s
        - while:
            condition:
              - lambda: |- 
                  return id(fp1_mode).state == "Confort -2" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel0}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel1}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 53
              - switch.turn_on: ${relays_name}_${relays_channel0}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel1}_${relays_sufix}
              - delay: 7s

  - platform: template
    name: "fp2_mode"
    id: fp2_mode
    options:
     - "Confort"    #Pas de signal envoyé
     - "Eco"        #Alternance pleine
     - "Hors-gel"   #Alternance négative
     - "Arret"      #Alternance positive
     - "Confort -1" #Alternance pleine temporisé (4'57"off/3"on/..)
     - "Confort -2" #Alternance pleine temporisé (4'53"off/7"on/..)
    initial_option: "Confort"
    optimistic: true
    set_action:
      - logger.log:
          format: "Chosen option: %s"
          args: ["x.c_str()"]
      - lambda: |-
          id(fp2_mode).state = x.c_str(); 
    on_value:
      then:
        - if:
            condition:
              - lambda: |- 
                  return id(fp2_mode).state == "Confort" ;
            then:
              - switch.turn_off: "${relays_name}_${relays_channel2}_${relays_sufix}"
              - switch.turn_off: "${relays_name}_${relays_channel3}_${relays_sufix}"
        - if:
            condition:
              - lambda: |- 
                  return id(fp2_mode).state == "Eco" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel2}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel3}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp2_mode).state == "Hors-gel" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel2}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel3}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp2_mode).state == "Arrêt" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel2}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel3}_${relays_sufix}
        - while:
            condition:
              - lambda: |- 
                  return id(fp2_mode).state == "Confort -1" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel2}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel3}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 57
              - switch.turn_on: ${relays_name}_${relays_channel2}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel3}_${relays_sufix}
              - delay: 3s
        - while:
            condition:
              - lambda: |- 
                  return id(fp2_mode).state == "Confort -2" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel2}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel3}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 53
              - switch.turn_on: ${relays_name}_${relays_channel2}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel3}_${relays_sufix}
              - delay: 7s

  - platform: template
    name: "fp3_mode"
    id: fp3_mode
    options:
     - "Confort"    #Pas de signal envoyé
     - "Eco"        #Alternance pleine
     - "Hors-gel"   #Alternance négative
     - "Arret"      #Alternance positive
     - "Confort -1" #Alternance pleine temporisé (4'57"off/3"on/..)
     - "Confort -2" #Alternance pleine temporisé (4'53"off/7"on/..)
    initial_option: "Confort"
    optimistic: true
    set_action:
      - logger.log:
          format: "Chosen option: %s"
          args: ["x.c_str()"]
      - lambda: |-
          id(fp3_mode).state = x.c_str(); 
    on_value:
      then:
        - if:
            condition:
              - lambda: |- 
                  return id(fp3_mode).state == "Confort" ;
            then:
              - switch.turn_off: "${relays_name}_${relays_channel4}_${relays_sufix}"
              - switch.turn_off: "${relays_name}_${relays_channel5}_${relays_sufix}"
        - if:
            condition:
              - lambda: |- 
                  return id(fp3_mode).state == "Eco" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel4}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel5}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp3_mode).state == "Hors-gel" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel4}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel5}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp3_mode).state == "Arrêt" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel4}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel5}_${relays_sufix}
        - while:
            condition:
              - lambda: |- 
                  return id(fp3_mode).state == "Confort -1" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel4}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel5}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 57
              - switch.turn_on: ${relays_name}_${relays_channel4}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel5}_${relays_sufix}
              - delay: 3s
        - while:
            condition:
              - lambda: |- 
                  return id(fp3_mode).state == "Confort -2" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel4}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel5}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 53
              - switch.turn_on: ${relays_name}_${relays_channel4}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel5}_${relays_sufix}
              - delay: 7s

  - platform: template
    name: "fp4_mode"
    id: fp4_mode
    options:
     - "Confort"    #Pas de signal envoyé
     - "Eco"        #Alternance pleine
     - "Hors-gel"   #Alternance négative
     - "Arret"      #Alternance positive
     - "Confort -1" #Alternance pleine temporisé (4'57"off/3"on/..)
     - "Confort -2" #Alternance pleine temporisé (4'53"off/7"on/..)
    initial_option: "Confort"
    optimistic: true
    set_action:
      - logger.log:
          format: "Chosen option: %s"
          args: ["x.c_str()"]
      - lambda: |-
          id(fp4_mode).state = x.c_str(); 
    on_value:
      then:
        - if:
            condition:
              - lambda: |- 
                  return id(fp4_mode).state == "Confort" ;
            then:
              - switch.turn_off: "${relays_name}_${relays_channel6}_${relays_sufix}"
              - switch.turn_off: "${relays_name}_${relays_channel7}_${relays_sufix}"
        - if:
            condition:
              - lambda: |- 
                  return id(fp4_mode).state == "Eco" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel6}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel7}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp4_mode).state == "Hors-gel" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel6}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel7}_${relays_sufix}
        - if:
            condition:
              - lambda: |- 
                  return id(fp4_mode).state == "Arrêt" ;
            then:
              - switch.turn_on: ${relays_name}_${relays_channel6}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel7}_${relays_sufix}
        - while:
            condition:
              - lambda: |- 
                  return id(fp4_mode).state == "Confort -1" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel6}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel7}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 57
              - switch.turn_on: ${relays_name}_${relays_channel6}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel7}_${relays_sufix}
              - delay: 3s
        - while:
            condition:
              - lambda: |- 
                  return id(fp4_mode).state == "Confort -2" ;
            then:
              - switch.turn_off: ${relays_name}_${relays_channel6}_${relays_sufix}
              - switch.turn_off: ${relays_name}_${relays_channel7}_${relays_sufix}
              - delay: 
                  minutes: 4
                  seconds: 53
              - switch.turn_on: ${relays_name}_${relays_channel6}_${relays_sufix}
              - switch.turn_on: ${relays_name}_${relays_channel7}_${relays_sufix}
              - delay: 7s